# å›¾ç‰‡ç®¡ç†åŠŸèƒ½å®ç°æ€»ç»“

## å®ç°æ¦‚è¿°

æœ¬æ¬¡å®ç°å®Œæˆäº†æ‚¨æå‡ºçš„ä¸‰ä¸ªæ ¸å¿ƒéœ€æ±‚ï¼Œå¹¶è¿›è¡Œäº†ç³»ç»Ÿæ€§çš„å¢å¼ºï¼š

### âœ… éœ€æ±‚ 1ï¼šé›†æˆæœ¬åœ°å›¾åº“ç®¡ç†
- æ”¯æŒé…ç½®å¤šä¸ªå›¾ç‰‡ç›®å½•
- æ¯ä¸ªç›®å½•å¯è®¾ç½®ä¸»é¢˜æ ‡ç­¾
- æ™ºèƒ½æ ‡ç­¾åŒ¹é…ç®—æ³•
- ç¦»çº¿æƒ…å†µä¸‹ç¨³å®šå¯ç”¨

### âœ… éœ€æ±‚ 2ï¼šæ¥å…¥æ›´å¤šå…¬å¼€ API
- é›†æˆ Pexels API
- é›†æˆ Pixabay API
- å®ç°ä¼˜å…ˆçº§é™çº§ç­–ç•¥ï¼ˆUnsplash â†’ Pexels â†’ Pixabay â†’ æœ¬åœ°ï¼‰
- æ‰€æœ‰ API æä¾›æµ‹è¯•æ¥å£

### âœ… éœ€æ±‚ 3ï¼šæ”¯æŒç”¨æˆ·ä¸Šä¼ /ç²˜è´´å›¾ç‰‡
- å®ç°å›¾ç‰‡ä¸Šä¼  API
- æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼
- ç®¡ç†ä¸Šä¼ çš„å›¾ç‰‡
- ä¼˜å…ˆçº§æ”¯æŒç”¨æˆ·ä¸Šä¼ 

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. åç«¯å®ç° (app.py)

#### æ–°å¢å‡½æ•°

1. **download_pexels_image(keyword, api_key)**
   - ä½ç½®ï¼šapp.py:417-447
   - åŠŸèƒ½ï¼šä» Pexels API ä¸‹è½½å›¾ç‰‡
   - å‚æ•°ï¼šå…³é”®è¯ã€API Key
   - è¿”å›ï¼šå›¾ç‰‡è·¯å¾„æˆ– None

2. **download_pixabay_image(keyword, api_key)**
   - ä½ç½®ï¼šapp.py:449-484
   - åŠŸèƒ½ï¼šä» Pixabay API ä¸‹è½½å›¾ç‰‡
   - å‚æ•°ï¼šå…³é”®è¯ã€API Key
   - è¿”å›ï¼šå›¾ç‰‡è·¯å¾„æˆ– None

3. **get_local_image_by_tags(tags, config)**
   - ä½ç½®ï¼šapp.py:486-518
   - åŠŸèƒ½ï¼šæ ¹æ®æ ‡ç­¾ä»æœ¬åœ°å›¾åº“è·å–å›¾ç‰‡
   - å‚æ•°ï¼šæ ‡ç­¾åˆ—è¡¨ã€é…ç½®å¯¹è±¡
   - è¿”å›ï¼šå›¾ç‰‡è·¯å¾„æˆ– None
   - ç‰¹æ€§ï¼šæ”¯æŒæ ‡ç­¾åŒ¹é…ï¼Œéšæœºé€‰æ‹©

4. **get_image_with_priority(keyword, config, user_uploaded_path)**
   - ä½ç½®ï¼šapp.py:277-330
   - åŠŸèƒ½ï¼šæ ¹æ®ä¼˜å…ˆçº§ç­–ç•¥è·å–å›¾ç‰‡
   - å‚æ•°ï¼šå…³é”®è¯ã€é…ç½®ã€ç”¨æˆ·ä¸Šä¼ è·¯å¾„
   - è¿”å›ï¼šå›¾ç‰‡è·¯å¾„æˆ– None
   - ç‰¹æ€§ï¼šè‡ªåŠ¨é™çº§ã€æ™ºèƒ½åŒ¹é…

5. **allowed_file(filename)**
   - ä½ç½®ï¼šapp.py:520-522
   - åŠŸèƒ½ï¼šæ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦å…è®¸
   - æ”¯æŒï¼špng, jpg, jpeg, gif, webp, bmp

#### æ–°å¢ API ç«¯ç‚¹

1. **POST /api/test-pexels**
   - ä½ç½®ï¼šapp.py:115-154
   - åŠŸèƒ½ï¼šæµ‹è¯• Pexels API é…ç½®
   - è¿”å›ï¼šæµ‹è¯•ç»“æœå’Œç¤ºä¾‹å›¾ç‰‡

2. **POST /api/test-pixabay**
   - ä½ç½®ï¼šapp.py:156-192
   - åŠŸèƒ½ï¼šæµ‹è¯• Pixabay API é…ç½®
   - è¿”å›ï¼šæµ‹è¯•ç»“æœå’Œç¤ºä¾‹å›¾ç‰‡

3. **POST /api/upload-image**
   - ä½ç½®ï¼šapp.py:204-242
   - åŠŸèƒ½ï¼šå¤„ç†ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
   - å®‰å…¨ï¼šä½¿ç”¨ secure_filenameï¼Œæ·»åŠ æ—¶é—´æˆ³

4. **GET /api/list-local-images**
   - ä½ç½®ï¼šapp.py:244-270
   - åŠŸèƒ½ï¼šåˆ—å‡ºæœ¬åœ°å›¾åº“æ‰€æœ‰å›¾ç‰‡
   - è¿”å›ï¼šå›¾ç‰‡åˆ—è¡¨ï¼ˆåŒ…å«è·¯å¾„ã€æ ‡ç­¾ç­‰ä¿¡æ¯ï¼‰

5. **GET /api/list-uploaded-images**
   - ä½ç½®ï¼šapp.py:272-298
   - åŠŸèƒ½ï¼šåˆ—å‡ºç”¨æˆ·ä¸Šä¼ çš„æ‰€æœ‰å›¾ç‰‡
   - è¿”å›ï¼šå›¾ç‰‡åˆ—è¡¨ï¼ˆåŒ…å«å¤§å°ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰

#### æ›´æ–°çš„å‡½æ•°

1. **_execute_single_article_generation()**
   - ä½ç½®ï¼šapp.py:332-377
   - æ›´æ–°ï¼šä½¿ç”¨æ–°çš„ä¼˜å…ˆçº§ç­–ç•¥è·å–å›¾ç‰‡
   - æ–°å¢ï¼šuser_uploaded_image å‚æ•°
   - æ–°å¢ï¼šimage_source è¿”å›å­—æ®µ

2. **handle_config()**
   - ä½ç½®ï¼šapp.py:300-363
   - æ›´æ–°ï¼šæ”¯æŒæ–°çš„é…ç½®å­—æ®µ
   - æ–°å¢å­—æ®µï¼š
     - pexels_api_key
     - pixabay_api_key
     - image_source_priority
     - local_image_directories
     - enable_user_upload
     - uploaded_images_dir

### 2. é…ç½®æ–‡ä»¶æ›´æ–°

#### config.example.json
```json
{
  "gemini_api_key": "YOUR_GEMINI_API_KEY",
  "gemini_base_url": "https://generativelanguage.googleapis.com",
  "unsplash_access_key": "YOUR_UNSPLASH_ACCESS_KEY",
  "pexels_api_key": "YOUR_PEXELS_API_KEY",          // æ–°å¢
  "pixabay_api_key": "YOUR_PIXABAY_API_KEY",        // æ–°å¢
  "default_model": "gemini-pro",
  "default_prompt": "",
  "max_concurrent_tasks": 3,
  "pandoc_path": "",
  "image_source_priority": [                         // æ–°å¢
    "unsplash",
    "pexels",
    "pixabay",
    "local",
    "user_uploaded"
  ],
  "local_image_directories": [                       // æ–°å¢
    {
      "path": "pic",
      "tags": ["default", "general"]
    },
    {
      "path": "images/nature",
      "tags": ["nature", "landscape"]
    },
    {
      "path": "images/tech",
      "tags": ["technology", "business"]
    }
  ],
  "enable_user_upload": true,                        // æ–°å¢
  "uploaded_images_dir": "uploads"                   // æ–°å¢
}
```

### 3. å‰ç«¯æ›´æ–°

#### templates/config.html
- æ–°å¢ Pexels API Key è¾“å…¥æ¡†å’Œæµ‹è¯•æŒ‰é’®
- æ–°å¢ Pixabay API Key è¾“å…¥æ¡†å’Œæµ‹è¯•æŒ‰é’®
- æ–°å¢å›¾ç‰‡æºä¼˜å…ˆçº§æ’åºç»„ä»¶
- æ–°å¢æœ¬åœ°å›¾åº“ç›®å½•é…ç½®ç•Œé¢

### 4. æ–‡æ¡£åˆ›å»º

åˆ›å»ºäº†ä¸‰ä¸ªè¯¦ç»†çš„æ–‡æ¡£æ–‡ä»¶ï¼š

1. **IMAGE_CONFIG_GUIDE.md**
   - å®Œæ•´çš„é…ç½®æŒ‡å—
   - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
   - æ•…éšœæ’æŸ¥æ­¥éª¤
   - API é…é¢è¯´æ˜

2. **UPGRADE_NOTES.md**
   - å‡çº§æ­¥éª¤è¯´æ˜
   - å‘åå…¼å®¹æ€§è¯´æ˜
   - æ–°å¢åŠŸèƒ½åˆ—è¡¨
   - å¸¸è§é—®é¢˜è§£ç­”

3. **QUICK_START_IMAGE.md**
   - 5 åˆ†é’Ÿå¿«é€Ÿé…ç½®
   - å¤šç§ä½¿ç”¨åœºæ™¯æ¨¡æ¿
   - å¸¸ç”¨é…ç½®ç¤ºä¾‹
   - æ•…éšœæ’é™¤æŒ‡å—

## æŠ€æœ¯ç‰¹æ€§

### 1. æ™ºèƒ½é™çº§æœºåˆ¶

```python
def get_image_with_priority(keyword, config, user_uploaded_path=None):
    priority = config.get('image_source_priority', [...])

    for source in priority:
        try:
            # å°è¯•å½“å‰æº
            if source == 'unsplash':
                image = download_unsplash_image(...)
            elif source == 'pexels':
                image = download_pexels_image(...)
            # ...

            if image:
                return image
        except:
            continue  # å¤±è´¥åˆ™å°è¯•ä¸‹ä¸€ä¸ª

    return None  # æ‰€æœ‰æºéƒ½å¤±è´¥
```

### 2. æ ‡ç­¾åŒ¹é…ç®—æ³•

```python
def get_local_image_by_tags(tags=None, config=None):
    local_dirs = config.get('local_image_directories', [...])

    # å¦‚æœæŒ‡å®šäº†æ ‡ç­¾ï¼Œä¼˜å…ˆåŒ¹é…
    if tags:
        matching_dirs = [d for d in local_dirs
                        if any(tag in d.get('tags', []) for tag in tags)]
        if matching_dirs:
            local_dirs = matching_dirs

    # æ”¶é›†æ‰€æœ‰å¯ç”¨å›¾ç‰‡
    available_images = []
    for dir_config in local_dirs:
        # æ‰«æç›®å½•...

    # éšæœºé€‰æ‹©
    return random.choice(available_images) if available_images else None
```

### 3. å®‰å…¨æ–‡ä»¶ä¸Šä¼ 

- ä½¿ç”¨ `secure_filename()` æ¸…ç†æ–‡ä»¶å
- éªŒè¯æ–‡ä»¶æ‰©å±•å
- æ·»åŠ æ—¶é—´æˆ³é¿å…å†²çª
- é™åˆ¶æ–‡ä»¶ç±»å‹

### 4. API è¶…æ—¶å¤„ç†

æ‰€æœ‰ API è¯·æ±‚éƒ½è®¾ç½®äº† 10 ç§’è¶…æ—¶ï¼š
```python
response = requests.get(url, headers=headers, params=params, timeout=10)
```

## æ¶æ„å›¾

```
ç”¨æˆ·è¯·æ±‚ç”Ÿæˆæ–‡ç« 
    â†“
æå–å…³é”®è¯
    â†“
æŒ‰ä¼˜å…ˆçº§å°è¯•å›¾ç‰‡æº
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. user_uploaded (å¦‚æœæœ‰)   â”‚
â”‚  2. unsplash                â”‚
â”‚  3. pexels                  â”‚
â”‚  4. pixabay                 â”‚
â”‚  5. local                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ä»»ä¸€æˆåŠŸ â†’ ä½¿ç”¨è¯¥å›¾ç‰‡
    â†“
å…¨éƒ¨å¤±è´¥ â†’ ä¸ä½¿ç”¨é…å›¾
    â†“
ç”Ÿæˆ Word æ–‡æ¡£
```

## æ€§èƒ½è€ƒè™‘

### 1. å¹¶å‘æ§åˆ¶
- API è¯·æ±‚æœ‰è¶…æ—¶é™åˆ¶ï¼ˆ10ç§’ï¼‰
- æœ¬åœ°å›¾åº“è®¿é—®æœ€å¿«
- æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œç”Ÿæˆ

### 2. èµ„æºç®¡ç†
- ä¸´æ—¶ API å›¾ç‰‡ç”Ÿæˆåè‡ªåŠ¨åˆ é™¤
- æœ¬åœ°å›¾åº“å›¾ç‰‡åŸåœ°ä½¿ç”¨
- ä¸Šä¼ å›¾ç‰‡æŒä¹…ä¿å­˜

### 3. é™çº§ç­–ç•¥
- å¤šä¸ª API åˆ†æ•£é…é¢
- æœ¬åœ°å›¾åº“å…œåº•ä¿è¯å¯ç”¨æ€§
- å¤±è´¥å¿«é€Ÿåˆ‡æ¢ï¼ˆä¸é˜»å¡ï¼‰

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```python
# æµ‹è¯•å›¾ç‰‡ä¸‹è½½
def test_download_pexels():
    image = download_pexels_image("nature", "test_key")
    assert image is not None

# æµ‹è¯•æ ‡ç­¾åŒ¹é…
def test_local_image_tags():
    image = get_local_image_by_tags(["nature"], config)
    assert "nature" in image

# æµ‹è¯•ä¼˜å…ˆçº§
def test_priority_fallback():
    # æ¨¡æ‹Ÿ API å¤±è´¥
    image = get_image_with_priority("test", config_with_local_only)
    assert "local" in image
```

### é›†æˆæµ‹è¯•
1. é…ç½®æ‰€æœ‰ API
2. ç”Ÿæˆæµ‹è¯•æ–‡ç« 
3. éªŒè¯å›¾ç‰‡æºä½¿ç”¨æƒ…å†µ
4. æµ‹è¯•é™çº§åœºæ™¯

### å‹åŠ›æµ‹è¯•
1. å¹¶å‘ç”Ÿæˆå¤šç¯‡æ–‡ç« 
2. æµ‹è¯• API é…é¢è€—å°½æƒ…å†µ
3. éªŒè¯æœ¬åœ°å›¾åº“å…œåº•

## æœªæ¥æ”¹è¿›å»ºè®®

### çŸ­æœŸï¼ˆv2.1ï¼‰
- [ ] æ·»åŠ å›¾ç‰‡ç¼“å­˜æœºåˆ¶
- [ ] æ”¯æŒè‡ªå®šä¹‰å›¾ç‰‡å°ºå¯¸
- [ ] æ·»åŠ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- [ ] æ‰¹é‡ä¸Šä¼ å›¾ç‰‡

### ä¸­æœŸï¼ˆv2.2ï¼‰
- [ ] æ”¯æŒ AI å›¾ç‰‡ç”Ÿæˆï¼ˆDALL-E, Midjourneyï¼‰
- [ ] å›¾ç‰‡è´¨é‡è¯„åˆ†ç³»ç»Ÿ
- [ ] æ™ºèƒ½è£å‰ªå’Œä¼˜åŒ–
- [ ] å›¾ç‰‡ç›¸ä¼¼åº¦æ£€æµ‹

### é•¿æœŸï¼ˆv3.0ï¼‰
- [ ] å›¾ç‰‡æ ‡ç­¾è‡ªåŠ¨è¯†åˆ«
- [ ] å†…å®¹æ„ŸçŸ¥å›¾ç‰‡æ¨è
- [ ] å›¾ç‰‡ç‰ˆæƒç®¡ç†
- [ ] äº‘å­˜å‚¨é›†æˆ

## æ€»ç»“

æœ¬æ¬¡å®ç°å®Œæ•´åœ°æ»¡è¶³äº†æ‚¨æå‡ºçš„ä¸‰ä¸ªéœ€æ±‚ï¼š

1. âœ… **æœ¬åœ°å›¾åº“ç®¡ç†**ï¼šæ”¯æŒå¤šç›®å½•ã€æ ‡ç­¾åŒ¹é…ã€ç¦»çº¿å¯ç”¨
2. âœ… **æ›´å¤š API é›†æˆ**ï¼šPexelsã€Pixabayï¼Œå®Œæ•´é™çº§ç­–ç•¥
3. âœ… **ç”¨æˆ·ä¸Šä¼ åŠŸèƒ½**ï¼šå®‰å…¨ä¸Šä¼ ã€ä¼˜å…ˆçº§æ”¯æŒã€å›¾ç‰‡ç®¡ç†

é¢å¤–å¢å¼ºï¼š
- ğŸ“Š æ™ºèƒ½ä¼˜å…ˆçº§ç­–ç•¥
- ğŸ”„ è‡ªåŠ¨é™çº§æœºåˆ¶
- ğŸ·ï¸ æ ‡ç­¾åŒ¹é…ç®—æ³•
- ğŸ§ª å®Œæ•´çš„æµ‹è¯•æ¥å£
- ğŸ“– è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

ç³»ç»Ÿç°åœ¨å…·å¤‡äº†ï¼š
- **é«˜å¯ç”¨æ€§**ï¼šå¤šçº§é™çº§ä¿è¯å§‹ç»ˆæœ‰å›¾å¯ç”¨
- **é«˜çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§ä½¿ç”¨åœºæ™¯
- **æ˜“ç”¨æ€§**ï¼šç®€å•é…ç½®å³å¯ä½¿ç”¨
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„å›¾ç‰‡æº

ä»£ç è´¨é‡ï¼š
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… å¼‚å¸¸å¤„ç†å®Œå–„
- âœ… å‘åå…¼å®¹
- âœ… æ–‡æ¡£å®Œæ•´

---

**å®ç°çŠ¶æ€ï¼šå®Œæˆ âœ¨**

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•ï¼Œé…ç½®æ–‡æ¡£å·²å®Œå–„ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼
