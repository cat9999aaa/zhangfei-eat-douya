# å‡çº§è¯´æ˜ - å¢å¼ºçš„å›¾ç‰‡ç®¡ç†åŠŸèƒ½

## æ–°å¢åŠŸèƒ½æ¦‚è§ˆ

æœ¬æ¬¡æ›´æ–°ä¸ºç³»ç»Ÿæ·»åŠ äº†å…¨é¢çš„å›¾ç‰‡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤šå›¾ç‰‡æºæ”¯æŒã€æœ¬åœ°å›¾åº“ç®¡ç†å’Œç”¨æˆ·ä¸Šä¼ åŠŸèƒ½ã€‚

## ä¸»è¦æ›´æ–°

### 1. å¤šå›¾ç‰‡ API æ”¯æŒ
- âœ… **Unsplash**ï¼ˆåŸæœ‰ï¼‰- é«˜è´¨é‡å…è´¹å›¾ç‰‡
- âœ¨ **Pexels**ï¼ˆæ–°å¢ï¼‰- ä¸°å¯Œçš„å…è´¹å›¾ç‰‡å’Œè§†é¢‘
- âœ¨ **Pixabay**ï¼ˆæ–°å¢ï¼‰- å…è´¹å›¾ç‰‡å’Œæ’ç”»èµ„æº

### 2. æ™ºèƒ½å›¾ç‰‡æºä¼˜å…ˆçº§ç­–ç•¥
- å¯è‡ªå®šä¹‰å›¾ç‰‡æºä¼˜å…ˆçº§é¡ºåº
- è‡ªåŠ¨é™çº§æœºåˆ¶ï¼šå¦‚æœé¦–é€‰æºå¤±è´¥ï¼Œè‡ªåŠ¨å°è¯•ä¸‹ä¸€ä¸ª
- æ”¯æŒçš„å›¾ç‰‡æºç±»å‹ï¼š
  - `user_uploaded` - ç”¨æˆ·æ‰‹åŠ¨ä¸Šä¼ çš„å›¾ç‰‡
  - `unsplash` - Unsplash API
  - `pexels` - Pexels API
  - `pixabay` - Pixabay API
  - `local` - æœ¬åœ°å›¾åº“

### 3. æœ¬åœ°å›¾åº“ç®¡ç†
- æ”¯æŒé…ç½®å¤šä¸ªæœ¬åœ°å›¾ç‰‡ç›®å½•
- ä¸ºæ¯ä¸ªç›®å½•è®¾ç½®æ ‡ç­¾ï¼ˆtagsï¼‰
- ç³»ç»Ÿæ ¹æ®æ–‡ç« å…³é”®è¯æ™ºèƒ½åŒ¹é…æ ‡ç­¾
- ç¤ºä¾‹é…ç½®ï¼š
  ```json
  "local_image_directories": [
    {
      "path": "pic",
      "tags": ["default", "general"]
    },
    {
      "path": "images/nature",
      "tags": ["nature", "landscape", "outdoor"]
    },
    {
      "path": "images/tech",
      "tags": ["technology", "business", "computer"]
    }
  ]
  ```

### 4. ç”¨æˆ·ä¸Šä¼ åŠŸèƒ½
- æ”¯æŒæ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡ç”¨äºç‰¹å®šæ–‡ç« 
- æ”¯æŒçš„æ ¼å¼ï¼špng, jpg, jpeg, gif, webp, bmp
- ä¸Šä¼ çš„å›¾ç‰‡ä¿å­˜åœ¨é…ç½®çš„ `uploaded_images_dir` ç›®å½•
- API æ¥å£ï¼š`/api/upload-image`

## æ–°å¢ API æ¥å£

### æµ‹è¯•å›¾ç‰‡ API
- `POST /api/test-pexels` - æµ‹è¯• Pexels API é…ç½®
- `POST /api/test-pixabay` - æµ‹è¯• Pixabay API é…ç½®

### å›¾ç‰‡ç®¡ç†
- `POST /api/upload-image` - ä¸Šä¼ å›¾ç‰‡
- `GET /api/list-local-images` - åˆ—å‡ºæœ¬åœ°å›¾åº“ä¸­çš„æ‰€æœ‰å›¾ç‰‡
- `GET /api/list-uploaded-images` - åˆ—å‡ºç”¨æˆ·ä¸Šä¼ çš„æ‰€æœ‰å›¾ç‰‡

### é…ç½®æ¥å£æ›´æ–°
- `GET /api/config` - æ–°å¢å­—æ®µï¼š
  - `pexels_api_key_set` - Pexels API Key çŠ¶æ€
  - `pixabay_api_key_set` - Pixabay API Key çŠ¶æ€
  - `image_source_priority` - å›¾ç‰‡æºä¼˜å…ˆçº§é…ç½®
  - `local_image_directories` - æœ¬åœ°å›¾ç‰‡ç›®å½•é…ç½®
  - `enable_user_upload` - æ˜¯å¦å¯ç”¨ç”¨æˆ·ä¸Šä¼ 
  - `uploaded_images_dir` - ä¸Šä¼ å›¾ç‰‡ä¿å­˜ç›®å½•

## é…ç½®æ–‡ä»¶å˜æ›´

### config.json æ–°å¢å­—æ®µ

```json
{
  "pexels_api_key": "YOUR_PEXELS_API_KEY",
  "pixabay_api_key": "YOUR_PIXABAY_API_KEY",
  "image_source_priority": ["unsplash", "pexels", "pixabay", "local", "user_uploaded"],
  "local_image_directories": [
    {
      "path": "pic",
      "tags": ["default", "general"]
    }
  ],
  "enable_user_upload": true,
  "uploaded_images_dir": "uploads"
}
```

### é»˜è®¤å€¼
- `image_source_priority`: `["unsplash", "pexels", "pixabay", "local"]`
- `local_image_directories`: `[{"path": "pic", "tags": ["default"]}]`
- `enable_user_upload`: `true`
- `uploaded_images_dir`: `"uploads"`

## å‡çº§æ­¥éª¤

### 1. æ›´æ–°ä»£ç 
```bash
# å¤‡ä»½ç°æœ‰é…ç½®
cp config.json config.json.backup

# æ›´æ–°ä»£ç æ–‡ä»¶
# app.py å·²æ›´æ–°
# config.example.json å·²æ›´æ–°
```

### 2. å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰
```bash
pip install -r requirements.txt
```

æ³¨ï¼šæœ¬æ¬¡æ›´æ–°ä¸»è¦ä½¿ç”¨ç°æœ‰ä¾èµ–ï¼Œæ— éœ€å®‰è£…æ–°åŒ…ã€‚

### 3. æ›´æ–°é…ç½®æ–‡ä»¶

å¦‚æœä½ æƒ³ä½¿ç”¨æ–°åŠŸèƒ½ï¼Œéœ€è¦åœ¨ `config.json` ä¸­æ·»åŠ ç›¸å…³é…ç½®ï¼š

```json
{
  "gemini_api_key": "your_existing_key",
  "unsplash_access_key": "your_existing_key",

  // æ–°å¢ï¼šPexels APIï¼ˆå¯é€‰ï¼‰
  "pexels_api_key": "YOUR_PEXELS_KEY",

  // æ–°å¢ï¼šPixabay APIï¼ˆå¯é€‰ï¼‰
  "pixabay_api_key": "YOUR_PIXABAY_KEY",

  // æ–°å¢ï¼šå›¾ç‰‡æºä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å€¼ï¼‰
  "image_source_priority": ["unsplash", "pexels", "pixabay", "local"],

  // æ–°å¢ï¼šæœ¬åœ°å›¾åº“é…ç½®ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å€¼ï¼‰
  "local_image_directories": [
    {
      "path": "pic",
      "tags": ["default"]
    }
  ],

  // æ–°å¢ï¼šç”¨æˆ·ä¸Šä¼ åŠŸèƒ½ï¼ˆå¯é€‰ï¼Œé»˜è®¤å¯ç”¨ï¼‰
  "enable_user_upload": true,
  "uploaded_images_dir": "uploads",

  // ä¿æŒåŸæœ‰é…ç½®...
  "pandoc_path": "your_pandoc_path",
  "default_model": "gemini-pro",
  "max_concurrent_tasks": 3
}
```

### 4. åˆ›å»ºå¿…è¦çš„ç›®å½•

```bash
# åˆ›å»ºä¸Šä¼ ç›®å½•
mkdir uploads

# åˆ›å»ºé¢å¤–çš„æœ¬åœ°å›¾ç‰‡ç›®å½•ï¼ˆå¯é€‰ï¼‰
mkdir -p images/nature
mkdir -p images/tech
```

### 5. é‡å¯åº”ç”¨

```bash
python app.py
```

## å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å‘åå…¼å®¹** - å¦‚æœä¸é…ç½®æ–°åŠŸèƒ½ï¼Œç³»ç»Ÿå°†ç»§ç»­ä½¿ç”¨åŸæœ‰çš„æ–¹å¼å·¥ä½œï¼š
- ä»…ä½¿ç”¨ Unsplashï¼ˆå¦‚æœå·²é…ç½®ï¼‰
- æˆ–ä» `pic` ç›®å½•éšæœºé€‰æ‹©å›¾ç‰‡

## åŠŸèƒ½æµ‹è¯•

### æµ‹è¯• API è¿æ¥
1. è®¿é—®é…ç½®é¡µé¢ï¼š`http://localhost:5000/config`
2. è¾“å…¥ API Key
3. ç‚¹å‡»"æµ‹è¯• API"æŒ‰é’®éªŒè¯è¿æ¥

### æµ‹è¯•å›¾ç‰‡ä¸‹è½½
1. åœ¨å†™ä½œé¡µé¢è¾“å…¥ä¸»é¢˜
2. ç‚¹å‡»ç”Ÿæˆ
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤å›¾ç‰‡æºå°è¯•é¡ºåºå’Œç»“æœ

### æµ‹è¯•æœ¬åœ°å›¾åº“
1. åœ¨é…ç½®çš„æœ¬åœ°ç›®å½•ä¸­æ”¾å…¥å›¾ç‰‡
2. é…ç½®ç›¸åº”çš„æ ‡ç­¾
3. ç”Ÿæˆæ–‡ç« æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨åŒ¹é…

### æµ‹è¯•ç”¨æˆ·ä¸Šä¼ 
1. è®¿é—®å†™ä½œé¡µé¢
2. ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"æŒ‰é’®
3. é€‰æ‹©æœ¬åœ°å›¾ç‰‡æ–‡ä»¶
4. ä¸Šä¼ æˆåŠŸåç”Ÿæˆæ–‡ç« 

## ä½¿ç”¨å»ºè®®

### æ¨èé…ç½®ç­–ç•¥

#### ç­–ç•¥ 1ï¼šåœ¨çº¿ä¼˜å…ˆï¼ˆæ¨èï¼‰
é€‚åˆæœ‰ç¨³å®šç½‘ç»œè¿æ¥çš„ç¯å¢ƒï¼š
```json
"image_source_priority": ["unsplash", "pexels", "pixabay", "local"]
```

#### ç­–ç•¥ 2ï¼šç¦»çº¿ä¼˜å…ˆ
é€‚åˆç½‘ç»œä¸ç¨³å®šæˆ–ç¦»çº¿ç¯å¢ƒï¼š
```json
"image_source_priority": ["local", "unsplash", "pexels", "pixabay"]
```

#### ç­–ç•¥ 3ï¼šç”¨æˆ·æ§åˆ¶ä¼˜å…ˆ
é€‚åˆéœ€è¦ç²¾ç¡®é…å›¾çš„åœºæ™¯ï¼š
```json
"image_source_priority": ["user_uploaded", "local", "unsplash", "pexels", "pixabay"]
```

### API é…é¢ç®¡ç†

è€ƒè™‘åˆ°å…è´¹ API çš„é…é¢é™åˆ¶ï¼Œå»ºè®®ï¼š
1. é…ç½®å¤šä¸ª API æºä½œä¸ºå¤‡é€‰
2. è®¾ç½®åˆç†çš„ä¼˜å…ˆçº§é¡ºåº
3. å‡†å¤‡æœ¬åœ°å›¾åº“ä½œä¸ºæœ€ç»ˆå…œåº•

## å¸¸è§é—®é¢˜

### Q: å‡çº§ååŸæœ‰é…ç½®ä¼šä¸¢å¤±å—ï¼Ÿ
A: ä¸ä¼šã€‚ç³»ç»Ÿä¼šä¿ç•™æ‰€æœ‰åŸæœ‰é…ç½®ï¼Œæ–°å­—æ®µä½¿ç”¨é»˜è®¤å€¼ã€‚

### Q: å¿…é¡»é…ç½®æ‰€æœ‰å›¾ç‰‡ API å—ï¼Ÿ
A: ä¸å¿…é¡»ã€‚ä½ å¯ä»¥åªé…ç½®éœ€è¦çš„ APIï¼Œæœªé…ç½®çš„æºä¼šè¢«è‡ªåŠ¨è·³è¿‡ã€‚

### Q: æœ¬åœ°å›¾åº“æ ‡ç­¾å¦‚ä½•åŒ¹é…ï¼Ÿ
A: ç³»ç»Ÿä»æ–‡ç« ä¸­æå–å…³é”®è¯ï¼Œä¸ç›®å½•æ ‡ç­¾è¿›è¡ŒåŒ¹é…ã€‚åŒ¹é…ç®—æ³•æ”¯æŒéƒ¨åˆ†åŒ¹é…å’Œæ¨¡ç³ŠåŒ¹é…ã€‚

### Q: å›¾ç‰‡ä»å“ªé‡Œä¸‹è½½ï¼Ÿ
A:
- API å›¾ç‰‡ä¸´æ—¶ä¿å­˜åœ¨ `output` ç›®å½•ï¼Œç”Ÿæˆæ–‡æ¡£åè‡ªåŠ¨åˆ é™¤
- ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ä¿å­˜åœ¨é…ç½®çš„ `uploaded_images_dir` ç›®å½•
- æœ¬åœ°å›¾åº“çš„å›¾ç‰‡åŸåœ°ä½¿ç”¨ï¼Œä¸ä¼šå¤åˆ¶

### Q: å¦‚ä½•æŸ¥çœ‹å›¾ç‰‡æºä½¿ç”¨æƒ…å†µï¼Ÿ
A: æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œç³»ç»Ÿä¼šè¾“å‡ºè¯¦ç»†çš„å›¾ç‰‡æºå°è¯•å’Œç»“æœä¿¡æ¯ã€‚

## æŠ€æœ¯æ”¯æŒ

è¯¦ç»†ä½¿ç”¨æŒ‡å—è¯·å‚è€ƒï¼š`IMAGE_CONFIG_GUIDE.md`

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ§åˆ¶å°æ—¥å¿—è¾“å‡º
2. API Key æ˜¯å¦æ­£ç¡®
3. ç½‘ç»œè¿æ¥çŠ¶æ€
4. æœ¬åœ°ç›®å½•æƒé™

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-XX-XX)
- âœ¨ æ–°å¢ Pexels API æ”¯æŒ
- âœ¨ æ–°å¢ Pixabay API æ”¯æŒ
- âœ¨ æ–°å¢å›¾ç‰‡æºä¼˜å…ˆçº§é…ç½®
- âœ¨ æ–°å¢æœ¬åœ°å›¾åº“ç®¡ç†ï¼ˆå¤šç›®å½•ã€æ ‡ç­¾ï¼‰
- âœ¨ æ–°å¢ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½
- âœ¨ æ–°å¢å›¾ç‰‡æºé™çº§ç­–ç•¥
- ğŸ› ä¿®å¤å›¾ç‰‡ä¸‹è½½è¶…æ—¶é—®é¢˜
- ğŸ“ æ·»åŠ è¯¦ç»†é…ç½®æ–‡æ¡£

## è´¡çŒ®è€…

æ„Ÿè°¢æ‰€æœ‰ä¸ºæ­¤åŠŸèƒ½åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

**æ³¨æ„**ï¼šè¯·åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†æµ‹è¯•æ–°åŠŸèƒ½ã€‚
